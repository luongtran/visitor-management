<script type="text/javascript">
	$(document).ready(function() {
		$('#bt-optional-field').click(function() {
			//$(this).hide();
			$('.optional-fields').show();
		});
	});
</script>
<%= form_for @visitor, :html => { :class => 'form-horizontal', :name => "checkinform" } do |f| %>
	<div class="row-fluid">
		<span class="span5">
			<label>
				<div class="required label label-info">required</div>
				<%= f.text_field :visitor_mobile_number, :class => 'input-block-level', :placeholder => "Visitor mobile number" %>
			</label>
			<label>
              	<div class="required label label-info">required</div>
                <%= f.text_field :visitor_name, {:class => "input-block-level", :placeholder => "Visitor name"} %>  
                
            </label>
            <label>
            	<%= f.text_field :visitor_company_name, {:class => "input-block-level", :placeholder => "Visitor company name"} %>
                  
            </label>
            <label>
              <div class="required label label-info">required</div>
              	<%= f.text_field :here_to_meet, {:class => "input-block-level", :placeholder => "Here to meet"} %>
            </label>
            <label>
            	<%= f.text_field :reason_to_visit, {:class => "input-block-level", :placeholder => "Purpose of visit"} %>
              
            </label>
            <label>
            	<%= f.text_field :location, {:class => "input-block-level", :placeholder => "Location to visit"} %>
              
            </label>
            <label>
            	<%= f.text_field :badge_number, {:class => "input-block-level", :placeholder => "Badge number of &lt;User company name&gt;"} %>
              
            </label>
            <label>
              <%= f.submit "Save", :class => 'save btn btn-large btn-success' %>	
              
              <!-- <button name="print" class="save btn btn-large btn-success">Print</button> -->
              <%= f.submit "Save and print", :class => "save btn btn-large btn-success" %>
              
              <%= link_to t('.cancel', :default => t("helpers.links.cancel")),
                new_visitor_path, :class => 'save btn btn-large btn-success' %>
              
            </label>
		</span>
		<span class="span1">
			<div class="break"></div>
		</span>
		<span class="span6">
			<label>
	            <div class="avatarinput row-fluid capturebt">
	            	<span class="span6">
		              	<div id="webcam"></div>
		              	<!-- <img src="http://genk2.vcmedia.vn/N0WoyYblO3QdmZFKPMtKnadHAHTevz/Image/2012/Tran-Anh/1_original-(Copy)-58670.jpg" class="img-rounded"> -->
	              		<input type="button" value="Capture" class="capture btn btn-small btn-success" onclick="webcam.snap();"/>
	          		</span>
	          		<span class="span6"></span>
          		</div>
            </label>
			<!-- <label>
				<%= f.text_field :coming_from, {:class => "input-block-level", :placeholder => "Coming from"} %>
		    </label> -->
		    
		    <label>
		    	<%= f.text_field :visitor_vehicle_number, :class => 'input-block-level', :placeholder => "Visitor vehicle number" %>
		    </label>
		    
		    <label>
		    	<%= f.text_field :authorized_id, {:class => "input-block-level", :placeholder => "Any authorized identity number"} %>
		    </label>
		    
		    <label>
		    	<%= f.text_field :storage_device_detail, {:class => "input-block-level", :placeholder => "Store device serial number"} %>
		    </label>
		    
		    <label>
		    	<%= f.text_area :comment, :class => 'input-block-level', :rows => 7, :cols => 60, :placeholder => "Comments" %>
		      
		    </label>
    </span>
</div>
<% end %>

<script type="text/javascript">
	   function onload_complete(msg) {
	        // fetch the CSRF meta tag data
	        var csrf_param = $('meta[name=csrf-param]').attr('content');
	        var csrf_token = $('meta[name=csrf-token]').attr('content');
	        //alert(csrf_param + ", " + csrf_token);
	        
	        // reset the api URL appending the auth token parameter
	        webcam.set_api_url('<%= upload_photos_path %>' + '?' + csrf_param + "=" + encodeURI(encodeURI(csrf_token)));
	    }
	
	    function upload_complete(msg) {
	        if (msg == 'ok') {
	            $('#new_photo').show();
	            $('#visitor_visitor_vehicle_number').focus();
	        } else {
	            alert('An error occured');
	            webcam.reset();
	        }
	    }
	
	    webcam.set_swf_url('/webcam.swf');
	    //webcam.configure('camera');
	    //webcam.set_stealth(true)
	    webcam.set_api_url('<%= upload_photos_path %>');
	    webcam.set_quality(90);
	    webcam.set_shutter_sound(true, '/shutter.mp3');
	    webcam.set_hook('onLoad', 'onload_complete');
	    webcam.set_hook('onComplete', 'upload_complete');
	    $('#webcam').html(webcam.get_html(320, 240));
	    
</script>
  
